# mufit 2

Specification and prototype of the mufit 2 algorithm designed to fit a smooth growth rate curve to raw time series data from a turbidostat.

## Input data

* list of $N$ timepoints, $t = \{t_1, t_2, \ldots t_N\}$, where $t_1 = 0$
* list of $N$ log optical density (OD) measurementes $x = \{x_1, x_2, \ldots x_N\}$
* partition of the indexes $\{1,2, \ldots N\}$ into $R$ regions: $\{r_1, r_2, \ldots r_R\}$, where each region $r$ consists of a set of consecutive indices, and regions are non-overlapping: $r = \{s(r), s(r) + 1, \ldots e(r)-1, e(r)\}$, where $s(r)$ and $e(r)$ are the first and last indices belonging to the region $r$, respectively.

## Model

* Within each region $r$, the noisless log-OD grows according to a quadratic function of time, i.e. the growth rate $\mu(t)$ is assumed to change linearly between the start and the end of the region:
$$
    \mu_r(t) = \mu_{r,1} \frac{t_{e(r)} - t}{ t_{e(r)} - t_{s(r)}} + \mu_{r,2} \frac{t - t_{s(r)}}{ t_{e(r)} - t_{s(r)}}\quad ,
$$
$$
    x^\text{ideal}_r(t) = x_{r,0} + \intop_{t_{s(r)}} ^ t \! dt'\,  \mu_r(t')\quad ,
$$
where $x_{r,0}, \mu_{r,1}, \mu_{r,2}$ are model parameters.

* Each observed log-OD $x_n$ is generated by a normal distribution
$$
    P(x_n\;|\;\ldots) = \text{Normal}(x_n\;|\;\text{mean}=x_{r[n]}^\text{ideal}(t_n), \text{variance}=\sigma_x^2)\quad , 
$$
where $r[n]$ is the region to which index $n$ belongs, and $\sigma_x$  is a model parameter.

* To achieve smoothing of $\mu(t)$ across regions, we model its time series $(T, \mu)$:
$$
T = \bigoplus_{r=1}^R\big(t_{s(r)}, t_{e(r)}\big)\quad,\qquad 
\mu = \bigoplus_{r=1}^R\big(\mu_{r,1}, \mu_{r,2}\big)
$$ 
with a Gaussian process:
$$
    P(\mu\;|\;T, \ldots) = \text{Normal}(\mu\;|\;\text{mean} = \mu_0 + \nu_0 T,\text{covariance} = K),
$$
where $\mu_0$ and $\nu_0$ are model parameters, and the covariance matrix $K_{i,j} = \kappa(T_i, T_j)$ is generated by the covariance function $\kappa$
$$
    \kappa = \kappa_\text{sq.exp} + \kappa_\text{intBM} \\
    \kappa_\text{sq.exp}(T_i, T_j) = \sigma_\mu^2 \exp\left(-\frac{|T_i - T_j|^2}{2\tau^2}\right) \\
    \kappa_\text{intBM}(T_i, T_j) = D \frac{(\text{min}(T_i, T_j))^2}{2} \left(\text{max}(T_i, T_j) - \frac{\text{min}(T_i, T_j)}{3}\right)
$$
where $\sigma_\mu, \tau, D$ are model parameters. This choice of covariance ensures that rapid changes of $\mu$ are allowed, by the the squared exponential part, and long-term trends are captured, by the integrated Brownian motion part.

## Output

After marginalizing out $x_0, \mu_1, \mu_2$, we numerically optimize the values of to obtain

* the maximum likelihood estimators for $\sigma_x, \sigma_\mu, \tau, D, \mu_0, \nu_0$, and
* posterior means and standard deviations of $x_0, \mu_1, \mu_2$
* predictive means and standard deviations of $x$.
